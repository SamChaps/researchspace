<semantic-query query='
          SELECT ?class ?name ?uuid WHERE {
            <[[this]]> <http://hercules.gouv.qc.ca/ontology/meta/hasClass> ?class .
            <[[this]]> <http://hercules.gouv.qc.ca/ontology/meta/hasName> ?name .
            BIND(STRUUID() as ?uuid)
          }
        ' template='{{> template}}'>
  <template id='template'>
    <div>
      {{#each bindings}}      
      <semantic-form new-subject-template='http://culture.gouv.qc.ca/entity/{{uuid.value}}' post-action='redirect'
        browser-persistence=true form-id='FieldForm' fields='[
        {
          "id": "type",
          "label": "Type",
          "description": "Le type du formulaire",
          "xsdDatatype": "xsd:anyURI",
          "selectPattern": "SELECT $value WHERE { $subject a $value }",
          "insertPattern": "INSERT { $subject a $value } WHERE { }",
          "deletePattern": "DELETE { $subject a $value } WHERE { }"
        },
        {
          "id": "class",
          "label": "Class",
          "description": "La classe de l&#39;entité à créer par le formulaire",
          "xsdDatatype": "xsd:anyURI",
          "selectPattern": "SELECT $value WHERE { $subject <http://hercules.gouv.qc.ca/ontology/meta/hasClass> $value }",
          "insertPattern": "INSERT { $subject <http://hercules.gouv.qc.ca/ontology/meta/hasClass> $value } WHERE { }",
          "deletePattern": "DELETE { $subject <http://hercules.gouv.qc.ca/ontology/meta/hasClass> $value } WHERE { }"
        },
        {
          "id": "field",
          "label": "Field",
          "description": "Le champ à ajouter au formulaire",
          "xsdDatatype": "xsd:anyURI",
          "minOccurs": "1",
          "valueSetPattern": "
            SELECT $value $label WHERE {
              <[[this]]>  <http://hercules.gouv.qc.ca/ontology/meta/hasClass> ?class .
              SERVICE <http://hercules-blazegraph:8080/blazegraph/namespace/assets/sparql> {
                $value a <http://www.metaphacts.com/ontology/fields#Field> .
                $value rdfs:label $label .
                $value <http://www.metaphacts.com/ontology/fields#domain> ?class .
              }
            }
          ",
          "selectPattern": "SELECT $value WHERE { $subject <http://hercules.gouv.qc.ca/ontology/meta/hasField> $value }",
          "insertPattern": "INSERT { $subject <http://hercules.gouv.qc.ca/ontology/meta/hasField> $value } WHERE { }",
          "deletePattern": "DELETE { $subject <http://hercules.gouv.qc.ca/ontology/meta/hasField> $value } WHERE { }"
        },
        {
          "id": "name",
          "label": "Nom",
          "description": "Le nom du formulaire",
          "xsdDatatype": "xsd:string",
          "minOccurs": "1",
          "maxOccurs": "1",
          "selectPattern": "SELECT $value WHERE { $subject <http://hercules.gouv.qc.ca/ontology/meta/hasName> $value }",
          "insertPattern": "INSERT { $subject <http://hercules.gouv.qc.ca/ontology/meta/hasName> $value } WHERE { }",
          "deletePattern": "DELETE { $subject <http://hercules.gouv.qc.ca/ontology/meta/hasName> $value } WHERE { }"
        }
        ]'>
        <bs-panel>
          <h4>Définir les champs requis</h4>
          <semantic-form-recover-notification></semantic-form-recover-notification>
          <bs-tabs fixed-key="form">
            <semantic-form-hidden-input for='type'
              default-value='http://hercules.gouv.qc.ca/ontology/meta/InstanceForm'>
            </semantic-form-hidden-input>
            <semantic-form-hidden-input for='class' default-value='{{class.value}}'></semantic-form-hidden-input>
            <semantic-form-hidden-input for='name' default-value='{{name.value}}'></semantic-form-hidden-input>
            <semantic-form-select-input for='field'></semantic-form-select-input>
            
            <button name='submit' class='btn btn-default'>Suivant</button>
            <button name='reset' class='btn btn-default'>Initialiser</button>
          </bs-tabs>
        </bs-panel>
      </semantic-form>
      {{/each}}
    </div>
  </template>
</semantic-query>